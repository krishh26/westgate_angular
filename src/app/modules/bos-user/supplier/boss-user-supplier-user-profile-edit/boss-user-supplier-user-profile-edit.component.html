<main id="main">
  <section class="casestudy-section">
    <div class="container-fluid">
      <div class="row">
        <div class="row align-items-center justify-content-between">
          <div class="col-lg-10 col-12">
            <h4 class="text-theme"><strong>Edit Supplier Details</strong></h4>
          </div>
        </div>
      </div>
    </div>
    <br />

    <div class="container-fluid">
      <form (ngSubmit)="submitForm()" autocomplete="off" novalidate>
        <div class="row">
          <div class="col-12">
            <div class="row">
              <!-- Company Details -->
              <div class="col-12">
                <h5 class="text-primary mb-3">Company Details</h5>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="companyName" class="col-sm-4 col-form-label">Company Name <span class="text-danger">*</span></label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.companyName" name="companyName" class="form-control"
                      placeholder="Enter company name" id="companyName" required #companyNameInput="ngModel">
                    <div *ngIf="companyNameInput.invalid && (companyNameInput.dirty || companyNameInput.touched)" class="text-danger small">
                      Company Name is required
                    </div>
                  </div>
                </div>
              </div>

              <!-- <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="logo" class="col-sm-4 col-form-label">Company Logo URL</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.logo" name="logo" type="text" class="form-control"
                      placeholder="Enter logo URL" id="logo">
                  </div>
                </div>
              </div> -->

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="website" class="col-sm-4 col-form-label">Company Website</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.website" name="website" type="text" class="form-control"
                      placeholder="Enter company website" id="website">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="companyAddress" class="col-sm-4 col-form-label">Company Address</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.companyAddress" name="companyAddress" type="text" class="form-control"
                      placeholder="Enter company address" id="companyAddress">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="country" class="col-sm-4 col-form-label">Country</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.country" name="country" type="text" class="form-control"
                      placeholder="Enter country" id="country">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="email" class="col-sm-4 col-form-label">Contact Email</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.email" name="email" type="text" class="form-control"
                      placeholder="Enter contact email" id="email">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="phone" class="col-sm-4 col-form-label">Contact Number</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.companyContactNumber" name="phone" type="text" class="form-control"
                      placeholder="Enter contact number" [maxlength]="10" [minlength]="10" (keypress)="NumberOnly($event)" id="phone">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="yearOfEstablishment" class="col-sm-4 col-form-label">Year Established</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.yearOfEstablishment" name="yearOfEstablishment" type="date"
                      class="form-control" id="yearOfEstablishment" [max]="today">
                  </div>
                </div>
              </div>

              <div class="col-md-12 mb-3">
                <div class="row">
                  <label for="executiveSummary" class="col-sm-2 col-form-label">Executive Summary</label>
                  <div class="col-sm-10">
                    <textarea [(ngModel)]="supplierDetails.executiveSummary" name="executiveSummary" class="form-control"
                      placeholder="Enter company executive summary" id="executiveSummary" rows="4"></textarea>
                  </div>
                </div>
              </div>

              <!-- POC Details -->
              <div class="col-12">
                <h5 class="text-primary mb-3">POC Details</h5>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="poc_name" class="col-sm-4 col-form-label">POC Name <span class="text-danger">*</span></label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.poc_name" name="poc_name" type="text" class="form-control"
                      placeholder="Enter POC name" id="poc_name" required #pocNameInput="ngModel">
                    <div *ngIf="pocNameInput.invalid && (pocNameInput.dirty || pocNameInput.touched)" class="text-danger small">
                      POC Name is required
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="poc_phone" class="col-sm-4 col-form-label">POC Phone <span class="text-danger">*</span></label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.poc_phone" name="poc_phone" type="text" class="form-control"
                      placeholder="Enter POC phone number" [maxlength]="10" [minlength]="10" (keypress)="NumberOnly($event)"
                      id="poc_phone" required #pocPhoneInput="ngModel">
                    <div *ngIf="pocPhoneInput.invalid && (pocPhoneInput.dirty || pocPhoneInput.touched)" class="text-danger small">
                      POC Phone is required
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="poc_email" class="col-sm-4 col-form-label">POC Email</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.poc_email" name="poc_email" type="text" class="form-control"
                      placeholder="Enter POC email" id="poc_email">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="poc_role" class="col-sm-4 col-form-label">POC Role</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.poc_role" name="poc_role" type="text" class="form-control"
                      placeholder="Enter POC role" id="poc_role">
                  </div>
                </div>
              </div>

              <!-- Business Details -->
              <div class="col-12">
                <h5 class="text-primary mb-3">Business Details</h5>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="typeOfCompany" class="col-sm-4 col-form-label">Business Type</label>
                  <div class="col-sm-8">
                    <div class="form-control p-2">
                      <div *ngFor="let type of supplierDetails.typeOfCompany; let i = index" class="mb-2">
                        <div class="d-flex align-items-center">
                          <span class="badge bg-primary me-2">{{ type }}</span>
                          <button type="button" class="btn-close ms-2" (click)="removeArrayItem('typeOfCompany', i)"></button>
                        </div>
                      </div>
                      <div class="mt-2">
                        <input type="text" class="form-control" placeholder="Enter business type and press Enter"
                          (keydown.enter)="handleEnterKey($event, 'typeOfCompany')">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="industry_Sector" class="col-sm-4 col-form-label">Industry Sector</label>
                  <div class="col-sm-8">
                    <ng-select
                      placeholder="Select Industry Sector"
                      class="custom-ng-select-option"
                      [items]="industryList"
                      bindLabel="name"
                      [multiple]="true"
                      bindValue="value"
                      [(ngModel)]="selectedIndustries"
                      name="selectedIndustries"
                      (change)="onIndustryChange()"
                      [addTag]="addIndustry">
                    </ng-select>
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="employeeCount" class="col-sm-4 col-form-label">Company Size</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.employeeCount" name="employeeCount" type="text" class="form-control"
                      placeholder="Enter employee count" (keypress)="NumberOnly($event)" id="employeeCount">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="turnover" class="col-sm-4 col-form-label">Turnover</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.turnover" name="turnover" type="text" class="form-control"
                      placeholder="Enter turnover" (keypress)="NumberOnly($event)" id="turnover">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="totalProjectsExecuted" class="col-sm-4 col-form-label">Total Projects Executed</label>
                  <div class="col-sm-8">
                    <input [(ngModel)]="supplierDetails.totalProjectsExecuted" name="totalProjectsExecuted" type="text" class="form-control"
                      placeholder="Enter total projects executed" (keypress)="NumberOnly($event)" id="totalProjectsExecuted">
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="certifications" class="col-sm-4 col-form-label">Certifications</label>
                  <div class="col-sm-8">
                    <div class="form-control p-2">
                      <div *ngFor="let cert of supplierDetails.certifications; let i = index" class="mb-2">
                        <div class="d-flex align-items-center">
                          <span class="badge bg-primary me-2">{{ cert }}</span>
                          <button type="button" class="btn-close ms-2" (click)="removeArrayItem('certifications', i)"></button>
                        </div>
                      </div>
                      <div class="mt-2">
                        <input type="text" class="form-control" placeholder="Enter certification and press Enter"
                          (keydown.enter)="handleEnterKey($event, 'certifications')">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="expertise" class="col-sm-4 col-form-label">Expertise</label>
                  <div class="col-sm-8">
                    <div class="form-control p-2">
                      <div *ngFor="let expertise of supplierDetails.expertise; let i = index" class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                          <span class="badge bg-primary me-2">{{ expertise.name }}</span>
                          <button type="button" class="btn-close ms-2" (click)="removeExpertise(i)"></button>
                        </div>
                        <div class="ms-3">
                          <div *ngFor="let sub of expertise.subExpertise; let j = index"
                            class="d-flex align-items-center mb-1">
                            <span class="badge bg-secondary me-2">{{ sub }}</span>
                            <button type="button" class="btn-close ms-2" (click)="removeSubExpertise(i, j)"></button>
                          </div>
                          <div class="mt-2">
                            <div class="dropdown">
                              <ng-select
                                [(ngModel)]="selectedSubExpertiseMap[i]"
                                name="subExpertise_{{i}}"
                                [items]="subExpertiseOptions"
                                [multiple]="true"
                                placeholder="Select sub-expertise (required)"
                                [closeOnSelect]="false"
                                [searchable]="true"
                                [clearable]="true"
                                (change)="onSubExpertiseChange(i, $event)">
                              </ng-select>
                            </div>
                            <button type="button" class="btn btn-primary mt-2"
                              (click)="addMultipleSubExpertise(i)"
                              [disabled]="!selectedSubExpertiseMap[i] || selectedSubExpertiseMap[i].length === 0">
                              Add Sub-Expertise
                            </button>
                            <div *ngIf="expertise.subExpertise.length === 0" class="text-danger small mt-1">
                              Sub-expertise is required
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="mt-2">
                        <div class="dropdown">
                          <ng-select
                            placeholder="Select expertise"
                            [items]="expertiseDropdownOptions"
                            bindLabel="name"
                            [multiple]="true"
                            [(ngModel)]="selectedExpertiseItems"
                            name="selectedExpertiseItems"
                            [closeOnSelect]="false"
                            [searchable]="true"
                            [clearable]="true"
                            [addTag]="onAddTag">
                            <ng-template ng-tag-tmp let-search="searchTerm">
                              <div *ngIf="search">
                                <div class="mb-2">Add "{{search}}" to expertise</div>
                                <div class="radio-group d-flex flex-column">
                                  <div class="form-check mb-1">
                                    <input class="form-check-input" type="radio" name="expertiseType" id="typeTech"
                                      [(ngModel)]="newExpertiseType" value="technologies">
                                    <label class="form-check-label" for="typeTech">Technologies</label>
                                  </div>
                                  <div class="form-check mb-1">
                                    <input class="form-check-input" type="radio" name="expertiseType" id="typeProduct"
                                      [(ngModel)]="newExpertiseType" value="product">
                                    <label class="form-check-label" for="typeProduct">Product</label>
                                  </div>
                                  <div class="form-check">
                                    <input class="form-check-input" type="radio" name="expertiseType" id="typeDomain"
                                      [(ngModel)]="newExpertiseType" value="domain">
                                    <label class="form-check-label" for="typeDomain">Domain</label>
                                  </div>
                                </div>
                              </div>
                            </ng-template>
                          </ng-select>
                        </div>
                        <button type="button" class="btn btn-primary mt-2"
                          (click)="addSelectedExpertise()"
                          [disabled]="!selectedExpertiseItems || selectedExpertiseItems.length === 0">
                          Add Expertise
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="expertiseICanDo" class="col-sm-4 col-form-label">I Can Do</label>
                  <div class="col-sm-8">
                    <div class="form-control p-2">
                      <div *ngFor="let expertise of supplierDetails.expertiseICanDo; let i = index" class="mb-3">
                        <div class="d-flex align-items-center mb-2">
                          <span class="badge bg-primary me-2">{{ expertise.name }}</span>
                          <button type="button" class="btn-close ms-2" (click)="removeExpertiseICanDo(i)"></button>
                        </div>
                        <div class="ms-3">
                          <div *ngFor="let sub of expertise.subExpertise; let j = index"
                            class="d-flex align-items-center mb-1">
                            <span class="badge bg-secondary me-2">{{ sub }}</span>
                            <button type="button" class="btn-close ms-2" (click)="removeSubExpertiseICanDo(i, j)"></button>
                          </div>
                          <div class="mt-2">
                            <div class="dropdown">
                              <ng-select
                                [(ngModel)]="selectedSubExpertiseICanDoMap[i]"
                                name="subExpertiseICanDo_{{i}}"
                                [items]="subExpertiseICanDoOptions"
                                [multiple]="true"
                                placeholder="Select sub-expertise (required)"
                                [closeOnSelect]="false"
                                [searchable]="true"
                                [clearable]="true"
                                (change)="onSubExpertiseICanDoChange(i, $event)"
                                [addTag]="onAddTagSubExpertise"
                                [loading]="addingNewSubExpertise">
                                <ng-template ng-header-tmp>
                                  <div class="p-2 border-bottom">
                                    <div class="form-check">
                                      <input class="form-check-input" type="checkbox"
                                        [checked]="selectedSubExpertiseICanDoMap[i]?.length === subExpertiseICanDoOptions?.length"
                                        (change)="toggleSelectAllSubExpertiseICanDo(i, $event)">
                                      <label class="form-check-label">Select All</label>
                                    </div>
                                  </div>
                                </ng-template>
                                <ng-template ng-tag-tmp let-search="searchTerm">
                                  <div *ngIf="search">
                                    <span>Add new sub-expertise "{{search}}"</span>
                                  </div>
                                </ng-template>
                              </ng-select>
                            </div>
                            <button type="button" class="btn btn-primary mt-2"
                              (click)="addMultipleSubExpertiseICanDo(i)"
                              [disabled]="!selectedSubExpertiseICanDoMap[i] || selectedSubExpertiseICanDoMap[i].length === 0">
                              Add Sub-Expertise
                            </button>
                            <div *ngIf="expertise.subExpertise.length === 0" class="text-danger small mt-1">
                              Sub-expertise is required
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="mt-2">
                        <div class="dropdown">
                          <ng-select
                            placeholder="Select expertise"
                            [items]="expertiseDropdownOptions"
                            bindLabel="name"
                            [multiple]="true"
                            [(ngModel)]="selectedExpertiseICanDoItems"
                            name="selectedExpertiseICanDoItems"
                            [closeOnSelect]="false"
                            [searchable]="true"
                            [clearable]="true"
                            [addTag]="onAddTagICanDo">
                            <ng-template ng-header-tmp>
                              <div class="p-2 border-bottom">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox"
                                    [checked]="selectedExpertiseICanDoItems?.length === expertiseDropdownOptions?.length"
                                    (change)="toggleSelectAllExpertiseICanDo($event)">
                                  <label class="form-check-label">Select All</label>
                                </div>
                              </div>
                            </ng-template>
                            <ng-template ng-tag-tmp let-search="searchTerm">
                              <div *ngIf="search">
                                <div class="mb-2">Add "{{search}}" to expertise</div>
                                <div class="radio-group d-flex flex-column">
                                  <div class="form-check mb-1">
                                    <input class="form-check-input" type="radio" name="expertiseICanDoType" id="typeTechICanDo"
                                      [(ngModel)]="newExpertiseICanDoType" value="technologies">
                                    <label class="form-check-label" for="typeTechICanDo">Technologies</label>
                                  </div>
                                  <div class="form-check mb-1">
                                    <input class="form-check-input" type="radio" name="expertiseICanDoType" id="typeProductICanDo"
                                      [(ngModel)]="newExpertiseICanDoType" value="product">
                                    <label class="form-check-label" for="typeProductICanDo">Product</label>
                                  </div>
                                  <div class="form-check">
                                    <input class="form-check-input" type="radio" name="expertiseICanDoType" id="typeDomainICanDo"
                                      [(ngModel)]="newExpertiseICanDoType" value="domain">
                                    <label class="form-check-label" for="typeDomainICanDo">Domain</label>
                                  </div>
                                </div>
                              </div>
                            </ng-template>
                          </ng-select>
                        </div>
                        <button type="button" class="btn btn-primary mt-2"
                          (click)="addSelectedExpertiseICanDo()"
                          [disabled]="!selectedExpertiseICanDoItems || selectedExpertiseICanDoItems.length === 0">
                          Add Expertise
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="categoryList" class="col-sm-4 col-form-label">Category</label>
                  <div class="col-sm-8">
                    <ng-select
                      placeholder="Select Category"
                      class="custom-ng-select-option"
                      [items]="categoryDomains"
                      bindLabel="name"
                      [multiple]="true"
                      bindValue="value"
                      [(ngModel)]="selectedCategories"
                      name="selectedCategories"
                      (change)="onCategoryChange()"
                      [addTag]="addCategory">
                    </ng-select>
                  </div>
                </div>
              </div> -->

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="technologyStack" class="col-sm-4 col-form-label">Technology Stack</label>
                  <div class="col-sm-8">
                    <ng-select
                      placeholder="Select or add technologies"
                      class="custom-ng-select-option"
                      [items]="technologiesList"
                      bindLabel="name"
                      [multiple]="true"
                      [(ngModel)]="selectedTechnologies"
                      name="selectedTechnologies"
                      (change)="onTechnologiesChange()"
                      [addTag]="addTechnology"
                      [loading]="isLoadingTechnologies"
                      [typeahead]="technologiesInput$">
                    </ng-select>
                  </div>
                </div>
              </div>

              <!-- Key Clients -->
              <div class="col-12">
                <h5 class="text-primary mb-3">Client Information</h5>
              </div>

              <div class="col-md-6 mb-3">
                <div class="row">
                  <label for="keyClients" class="col-sm-4 col-form-label">Key Clients</label>
                  <div class="col-sm-8">
                    <div class="form-control p-2">
                      <div *ngFor="let client of supplierDetails.keyClients; let i = index" class="mb-2">
                        <div class="d-flex align-items-center">
                          <span class="badge bg-primary me-2">{{ client }}</span>
                          <button type="button" class="btn-close ms-2" (click)="removeArrayItem('keyClients', i)"></button>
                        </div>
                      </div>
                      <div class="mt-2">
                        <input type="text" class="form-control" placeholder="Enter key client and press Enter"
                          (keydown.enter)="handleEnterKey($event, 'keyClients')">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Supplier Type -->
        <div class="row mb-4">
          <div class="col-12">
            <h5 class="text-primary mb-3">Supplier Type <span class="text-danger">*</span></h5>
            <p class="text-muted small">At least one supplier type must be selected</p>
          </div>
          <div class="col-md-6 mb-3">
            <div class="row">
              <div class="col-sm-12">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox"
                    [(ngModel)]="supplierDetails.resourceSharingSupplier" name="resourceSharingSupplier"
                    id="resourceSharingSupplier" (change)="checkSupplierTypeSelection()">
                  <label class="form-check-label" for="resourceSharingSupplier">
                    Resource Sharing Supplier
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="row">
              <div class="col-sm-12">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox"
                    [(ngModel)]="supplierDetails.subcontractingSupplier" name="subcontractingSupplier"
                    id="subcontractingSupplier" (change)="checkSupplierTypeSelection()">
                  <label class="form-check-label" for="subcontractingSupplier">
                    Sub Contracting Supplier
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12" *ngIf="showSupplierTypeError">
            <div class="alert alert-danger py-1">
              Please select at least one supplier type
            </div>
          </div>
        </div>

        <!-- In Hold Comments -->
        <!-- <div class="row mb-4">
          <div class="col-12">
            <h5 class="text-primary mb-3">In Hold Comments</h5>
          </div>
          <div class="col-md-12 mb-3">
            <div class="row">
              <label for="inHoldComment" class="col-sm-4 col-form-label">Comment</label>
              <div class="col-sm-8">
                <input [(ngModel)]="inHoldComment" name="inHoldComment" type="text" class="form-control"
                  placeholder="Enter comment" id="inHoldComment">
              </div>
            </div>
          </div>
        </div> -->

        <!-- Submit Button -->
        <div class="row mt-4">
          <div class="col-12 text-end">
            <button type="button" routerLink="/boss-user/supplier-user-profile" class="btn btn-primary">Back</button>&nbsp;
            <button type="submit" class="btn btn-primary"
              [disabled]="!supplierDetails.companyName || !supplierDetails.poc_name || !supplierDetails.poc_phone ||
                        (!supplierDetails.resourceSharingSupplier && !supplierDetails.subcontractingSupplier) ||
                        hasInvalidExpertise()">
              Update Supplier
            </button>
          </div>
        </div>
      </form>
    </div>
  </section>
</main>
