<main id="main">
  <section class="casestudy-section">
    <div class="container-fluid">
      <!-- Header Section -->
      <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
          <h4 class="text-theme mb-1"><strong>{{expertiseName}} - Supplier Wise Sub-Expertise View</strong></h4>
          <p class="text-muted mb-0">Manage and view supplier expertise and sub-expertise</p>
        </div>
        <div>
          <button class="btn btn-primary btn-sm" (click)="goBack()">
            <i class="bi bi-arrow-left me-1"></i> Back to Expertise
          </button>
        </div>
      </div>

      <!-- No Records Found -->
      <div *ngIf="!suppliers || !suppliers.length" class="text-center py-4">
        <app-no-record-found></app-no-record-found>
      </div>

      <!-- Suppliers Accordion -->
      <div *ngIf="suppliers && suppliers.length > 0">
        <div *ngFor="let supplier of suppliers; let i = index" class="card mb-3 shadow-sm">
          <!-- Accordion Header -->
          <div class="card-header bg-light d-flex justify-content-between align-items-center"
               (click)="toggleCollapse(i)"
               style="cursor: pointer;">
            <div>
              <h6 class="mb-0 fw-bold">{{ supplier.name || 'Unnamed Supplier' }}</h6>
              <small class="text-muted">{{ supplier.expertise?.length || 0 }} expertise</small>
            </div>
            <div class="d-flex align-items-center">
              <span class="badge custom-light-badge me-2">{{ getAllSubExpertise(supplier).length }} Sub-expertise</span>
              <i class="bi" [ngClass]="isCollapsed(i) ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
            </div>
          </div>

          <!-- Accordion Body -->
          <div class="card-body" *ngIf="isCollapsed(i)">
            <ng-container *ngIf="supplier.expertise && supplier.expertise.length; else noExpertise">
              <div *ngFor="let exp of supplier.expertise; let expIndex = index" class="mb-3">
                <h6 class="text-primary fw-bold mb-2">{{ exp.name }}</h6>
                <div *ngIf="exp.subExpertise && exp.subExpertise.length; else noSub">
                  <span *ngFor="let sub of exp.subExpertise"
                        class="badge custom-light-badge me-2 mb-2">
                    {{ sub }}
                  </span>
                </div>
                <ng-template #noSub>
                  <span class="text-muted">No sub-expertise available</span>
                </ng-template>
              </div>
            </ng-container>

            <ng-template #noExpertise>
              <div class="text-center py-3">
                <span class="text-muted">No expertise data available</span>
              </div>
            </ng-template>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div class="d-flex justify-content-center mt-4" *ngIf="suppliers && suppliers.length > pagesize">
        <pagination-controls (pageChange)="page = $event"></pagination-controls>
      </div>
    </div>
  </section>
</main>

<!-- Loading Spinner -->
<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="medium" color="#fff" type="ball-scale-multiple">
  <p style="font-size: 20px; color: white">Loading...</p>
</ngx-spinner>
